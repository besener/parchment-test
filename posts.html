<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title">Parchment Post</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>
  <header>
    <h1>Parchment</h1>
    <nav>
      <a id="back-link" href="#">← Back to Page</a>
    </nav>
  </header>

  <main>
    <div class="post-featured-post">
      <img id="post-image" src="" alt="">
    </div>

    <article>
      <h2 id="post-title"></h2>
      <p><em id="post-date"></em></p>
      <div id="post-content"></div>
    </article>

    <p><a id="back-link-bottom" href="#" class="back-link">← Back to Page</a></p>
  </main>

  <footer>
    <p>
      <a href="about.html">About Me</a> |
      <span class="social-icons">
        <a href="https://github.com/username" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i></a>
        <a href="https://instagram.com/username" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
        <a href="https://flickr.com/username" target="_blank" rel="noopener noreferrer"><i class="fab fa-flickr"></i></a>
      </span>
    </p>
    <p>© 2025 Parchment</p>
  </footer>

  <script>
    const POSTS_PER_PAGE = 5;

    function getQueryParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    const postFile = getQueryParam('post');
    const pageNum = parseInt(getQueryParam('page')) || 1;

    if (!postFile) {
      document.querySelector('main').innerHTML = "<p>No post specified.</p>";
    } else {
      fetch("posts.json")
        .then(res => res.json())
        .then(posts => {
          posts.sort((a,b) => new Date(b.date) - new Date(a.date));
          const postIndex = posts.findIndex(p => p.file === postFile);
          if (postIndex === -1) {
            document.querySelector('main').innerHTML = "<p>Post not found.</p>";
            return;
          }

          const post = posts[postIndex];
          document.getElementById('page-title').textContent = `${post.title} - Parchment`;
          document.getElementById('post-title').textContent = post.title;
          document.getElementById('post-date').textContent = new Date(post.date).toLocaleDateString('en-US', {year:'numeric', month:'long', day:'numeric'});
          document.getElementById('post-image').src = post.image;
          document.getElementById('post-image').alt = post.title;

          // Load HTML content if exists (fallback to excerpt)
          fetch(`posts/${post.file}`)
            .then(r => r.text())
            .then(html => document.getElementById('post-content').innerHTML = html)
            .catch(() => document.getElementById('post-content').innerHTML = post.excerpt);

          const backLink = `index.html?page=${pageNum}`;
          document.getElementById('back-link').href = backLink;
          document.getElementById('back-link').textContent = `← Back to Page ${pageNum}`;
          document.getElementById('back-link-bottom').href = backLink;
          document.getElementById('back-link-bottom').textContent = `← Back to Page ${pageNum}`;
        })
        .catch(err => document.querySelector('main').innerHTML = `<p>Error loading post: ${err}</p>`);
    }
  </script>
</body>
</html>
